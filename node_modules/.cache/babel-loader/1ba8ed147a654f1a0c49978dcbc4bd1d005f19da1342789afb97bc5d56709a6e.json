{"ast":null,"code":"import{useState,useEffect}from\"react\";import{projectFirestore,projectAuth}from\"../firebase/config\";import{collection,addDoc,getDocs,query,where,orderBy,Timestamp,updateDoc,doc}from\"firebase/firestore\";import{onAuthStateChanged}from\"firebase/auth\";const useReviews=productNumber=>{const[reviews,setReviews]=useState([]);const[reviewText,setReviewText]=useState(\"\");const[user,setUser]=useState(null);useEffect(()=>{const fetchReviews=async()=>{const getReviews=await getDocs(query(collection(projectFirestore,\"reviews\"),where(\"product\",\"==\",productNumber),orderBy(\"timestamp\",\"desc\")));const reviewsData=getReviews.docs.map(doc=>({...doc.data(),id:doc.id}));setReviews(reviewsData);};fetchReviews();},[productNumber]);useEffect(()=>{const unsubscribe=onAuthStateChanged(projectAuth,user=>{if(user){setUser(user);}else{setUser(null);}});return()=>unsubscribe();},[]);const handleReviewSubmit=async()=>{const newReview={username:user?user.email:\"Anonymous\",date:new Date().toLocaleDateString(),text:reviewText,product:productNumber,timestamp:Timestamp.now()};try{const docReference=await addDoc(collection(projectFirestore,\"reviews\"),newReview);setReviews([...reviews,{...newReview,id:docReference.id}]);setReviewText(\"\");}catch(err){console.error(\"Error adding a new review: \",err);}};const handleReviewUpdate=async(id,updatedText)=>{try{const reviewDoc=doc(projectFirestore,\"reviews\",id);await updateDoc(reviewDoc,{text:updatedText,timestamp:Timestamp.now()});setReviews(reviews.map(review=>review.id===id?{...review,text:updatedText,timestamp:Timestamp.now()}:review));}catch(err){console.error(\"Error updating the review: \",err);}};return{reviews,reviewText,setReviewText,handleReviewSubmit,handleReviewUpdate,user,setReviews};};export default useReviews;","map":{"version":3,"names":["useState","useEffect","projectFirestore","projectAuth","collection","addDoc","getDocs","query","where","orderBy","Timestamp","updateDoc","doc","onAuthStateChanged","useReviews","productNumber","reviews","setReviews","reviewText","setReviewText","user","setUser","fetchReviews","getReviews","reviewsData","docs","map","data","id","unsubscribe","handleReviewSubmit","newReview","username","email","date","Date","toLocaleDateString","text","product","timestamp","now","docReference","err","console","error","handleReviewUpdate","updatedText","reviewDoc","review"],"sources":["/Users/zhaoruzhu/Downloads/StartupSystem/milestone-3-2/modern-shop/src/hooks/useReviews.js"],"sourcesContent":["import { useState, useEffect } from \"react\";\nimport { projectFirestore, projectAuth } from \"../firebase/config\";\nimport {\n  collection,\n  addDoc,\n  getDocs,\n  query,\n  where,\n  orderBy,\n  Timestamp,\n  updateDoc,\n  doc,\n} from \"firebase/firestore\";\nimport { onAuthStateChanged } from \"firebase/auth\";\n\nconst useReviews = (productNumber) => {\n  const [reviews, setReviews] = useState([]);\n  const [reviewText, setReviewText] = useState(\"\");\n  const [user, setUser] = useState(null);\n\n  useEffect(() => {\n    const fetchReviews = async () => {\n      const getReviews = await getDocs(\n        query(\n          collection(projectFirestore, \"reviews\"),\n          where(\"product\", \"==\", productNumber),\n          orderBy(\"timestamp\", \"desc\")\n        )\n      );\n      const reviewsData = getReviews.docs.map((doc) => ({\n        ...doc.data(),\n        id: doc.id,\n      }));\n      setReviews(reviewsData);\n    };\n\n    fetchReviews();\n  }, [productNumber]);\n\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(projectAuth, (user) => {\n      if (user) {\n        setUser(user);\n      } else {\n        setUser(null);\n      }\n    });\n\n    return () => unsubscribe();\n  }, []);\n\n  const handleReviewSubmit = async () => {\n    const newReview = {\n      username: user ? user.email : \"Anonymous\",\n      date: new Date().toLocaleDateString(),\n      text: reviewText,\n      product: productNumber,\n      timestamp: Timestamp.now(),\n    };\n\n    try {\n      const docReference = await addDoc(\n        collection(projectFirestore, \"reviews\"),\n        newReview\n      );\n      setReviews([...reviews, { ...newReview, id: docReference.id }]);\n      setReviewText(\"\");\n    } catch (err) {\n      console.error(\"Error adding a new review: \", err);\n    }\n  };\n\n  const handleReviewUpdate = async (id, updatedText) => {\n    try {\n      const reviewDoc = doc(projectFirestore, \"reviews\", id);\n      await updateDoc(reviewDoc, {\n        text: updatedText,\n        timestamp: Timestamp.now(),\n      });\n      setReviews(\n        reviews.map((review) =>\n          review.id === id\n            ? { ...review, text: updatedText, timestamp: Timestamp.now() }\n            : review\n        )\n      );\n    } catch (err) {\n      console.error(\"Error updating the review: \", err);\n    }\n  };\n\n  return {\n    reviews,\n    reviewText,\n    setReviewText,\n    handleReviewSubmit,\n    handleReviewUpdate,\n    user,\n    setReviews,\n  };\n};\n\nexport default useReviews;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}